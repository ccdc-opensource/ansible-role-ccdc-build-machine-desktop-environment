---
- name: Disable Sleep
  ansible.builtin.command: "{{ item }}"
  with_items:
    - systemsetup -setsleep Never
    - systemsetup -setharddisksleep Never
    - systemsetup -setcomputersleep Never
    - systemsetup -setdisplaysleep Never
  changed_when: false
  become: true

- name: Never Sleep Mode
  ansible.builtin.command: "{{ item }}"
  with_items:
    - pmset -a standbydelay 0
    - pmset -a displaysleep 0
    - pmset -a disablesleep 1
    - pmset -a disksleep 0
    - pmset -a hibernatemode 0
    - pmset disablesleep 1
    #  Not sure the stuff below works
    - systemsetup -setsleep Never
    - systemsetup -setharddisksleep Never
    - systemsetup -setcomputersleep Never
    - systemsetup -setdisplaysleep Never
  changed_when: false
  become: true

- name: Ensure homebrew is installed
  ansible.builtin.include_role:
    name: geerlingguy.mac.homebrew

- name: Add xfreebird/utils tap for kcpassword
  community.general.homebrew_tap:
    name: xfreebird/utils
    state: present

- name: Add kcpassword utility for autologin
  community.general.homebrew:
    name: kcpassword
    state: present

- name: Set autoLoginUser
  community.general.osx_defaults:
    domain: /Library/Preferences/com.apple.loginwindow
    key: autoLoginUser
    type: string
    value: vagrant
    state: present
  become: true

- name: Set the autologon password # noqa: no-changed-when
  ansible.builtin.command: /usr/local/bin/kcpassword "vagrant"
  become: true

- name: Set Europe/London time zone
  community.general.timezone:
    name: "Europe/London"
  become: true
